<div class="detail-container" *ngIf="!isLoading && profile && stats">
  
  <div class="header-row">
    <button class="btn-back" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Quay lại
    </button>
    <h2>Hồ sơ công dân</h2>
  </div>

  <div class="overview-section">
    
    <div class="info-card">
      <div class="avatar-box">
        {{ profile.fullName.charAt(0).toUpperCase() }}
      </div>
      <div class="user-details">
        <h3>{{ profile.fullName }}</h3>
        <p><i class="fas fa-envelope"></i> {{ profile.email }}</p>
        <p><i class="far fa-calendar-alt"></i> Tham gia: {{ profile.createdAt | date:'dd/MM/yyyy' }}</p>
        
        <div class="trust-status-chip" [ngClass]="{
          'status-good': stats.trustScore >= 50,
          'status-bad': stats.trustScore < 0
        }">
          {{ stats.trustStatus }}
        </div>
      </div>
    </div>

    <div class="score-card">
      <div class="score-label">ĐIỂM TIN CẬY</div>
      <div class="score-value" [ngClass]="{
        'text-green': stats.trustScore >= 50,
        'text-orange': stats.trustScore >= 0 && stats.trustScore < 50,
        'text-red': stats.trustScore < 0
      }">
        {{ stats.trustScore }}
      </div>
      <div class="score-limit">
        Hạn mức: {{ stats.dailyReportLimit }} bài/ngày
      </div>
    </div>

  </div>

  <div class="stats-grid">
    <div class="stat-box">
      <div class="stat-icon bg-blue"><i class="fas fa-layer-group"></i></div>
      <div class="stat-info">
        <span class="stat-num">{{ stats.totalIncidents }}</span>
        <span class="stat-name">Tổng báo cáo</span>
      </div>
    </div>

    <div class="stat-box">
      <div class="stat-icon bg-orange"><i class="fas fa-clock"></i></div>
      <div class="stat-info">
        <span class="stat-num">{{ stats.pendingIncidents }}</span>
        <span class="stat-name">Chờ xử lý</span>
      </div>
    </div>

    <div class="stat-box">
      <div class="stat-icon bg-green"><i class="fas fa-check-circle"></i></div>
      <div class="stat-info">
        <span class="stat-num">{{ stats.completedIncidents }}</span>
        <span class="stat-name">Đã xong</span>
      </div>
    </div>

    <div class="stat-box">
      <div class="stat-icon bg-red"><i class="fas fa-times-circle"></i></div>
      <div class="stat-info">
        <span class="stat-num">{{ stats.rejectedIncidents }}</span>
        <span class="stat-name">Bị từ chối</span>
      </div>
    </div>
  </div>

  <div class="history-panel">
    <h3><i class="fas fa-history"></i> Lịch sử báo cáo</h3>
    
    <div class="table-responsive">
      <table class="custom-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Tiêu đề</th>
            <th>Khu vực</th>
            <th>Ngày gửi</th>
            <th>Trạng thái</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of incidents" (click)="openIncidentModal(item)" style="cursor: pointer;">
            <td>#{{ item.incidentId }}</td>
            <td style="font-weight: 500;">{{ item.title }}</td>
            <td>{{ item.ward }}</td>
            <td>{{ item.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
            <td>
              <span class="status-badge" [ngClass]="getStatusClass(item.status)">
                {{ item.status }}
              </span>
            </td>
          </tr>
          <tr *ngIf="incidents.length === 0">
            <td colspan="5" style="text-align: center; padding: 30px; color: #999;">
              Người dân này chưa gửi báo cáo nào.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
  <app-incident-detail-modal 
  [isVisible]="isModalVisible" 
  [incident]="selectedIncident" 
  (onClose)="closeModal()">
</app-incident-detail-modal>

</div>
<div class="notify-container">
  
  <div class="notify-card">
    <div class="card-header">
      <i class="fas fa-exclamation-triangle text-red"></i>
      <h3>Gửi thông báo khẩn cấp (UC0013)</h3>
    </div>

    <div class="card-body">
      <div class="form-group">
        <label>TIÊU ĐỀ THÔNG BÁO</label>
        <input type="text" [(ngModel)]="data.title" placeholder="Ví dụ: Cảnh báo sạt lở đất...">
      </div>

      <div class="form-group">
        <label>NỘI DUNG CHI TIẾT</label>
        <textarea [(ngModel)]="data.content" rows="5" placeholder="Nội dung thông báo gửi đến người dân..."></textarea>
      </div>

      <div class="options-row">
        <div class="form-group col-half">
          <label>MỨC ĐỘ</label>
          <select [(ngModel)]="data.priority">
            <option value="Tin thường">Tin thường</option>
            <option value="Khẩn cấp">Khẩn cấp</option>
          </select>
        </div>
        <div class="form-group col-half">
          <label>KHU VỰC ÁP DỤNG</label>
          <select [(ngModel)]="data.scope">
            <option value="All">Toàn thành phố</option>
            <option value="Phường 1">Phường 1</option>
            <option value="Phường 2">Phường 2</option>
          </select>
        </div>
      </div>

      <button class="btn-send" (click)="openConfirmModal()">
        GỬI THÔNG BÁO NGAY
      </button>
    </div>
  </div>

</div>

<div class="modal-backdrop" *ngIf="showConfirmModal">
  <div class="modal-content">
    <div class="modal-icon icon-confirm">
      <i class="fas fa-question"></i>
    </div>
    <h3 class="modal-title">Xác nhận gửi?</h3>
    <p class="modal-desc">
      Bạn có chắc chắn muốn gửi thông báo này đến <b>{{ data.scope === 'All' ? 'toàn bộ người dân' : data.scope }}</b> không?
      <br><br>Hành động này không thể hoàn tác.
    </p>
    <div class="modal-actions">
      <button class="btn-modal btn-cancel" (click)="showConfirmModal = false">Hủy bỏ</button>
      <button class="btn-modal btn-confirm-modal" (click)="send()">
        {{ isLoading ? 'Đang gửi...' : 'Xác nhận gửi' }}
      </button>
    </div>
  </div>
</div>

<div class="modal-backdrop" *ngIf="isLoading" style="z-index: 3000;">
  <div class="modal-content" style="width: 300px; padding: 40px;">
    <div class="spinner"></div> <h3 class="modal-title" style="margin-top: 20px;">Đang gửi thông báo...</h3>
    <p class="modal-desc">Vui lòng không tắt trình duyệt.</p>
  </div>
</div>

<div class="modal-backdrop" *ngIf="resultModal.show" style="z-index: 3001;">
  <div class="modal-content">
    
    <div class="modal-icon" [ngClass]="resultModal.isSuccess ? 'icon-success' : 'icon-error'">
      <i class="fas" [ngClass]="resultModal.isSuccess ? 'fa-check' : 'fa-times'"></i>
    </div>

    <h3 class="modal-title">{{ resultModal.isSuccess ? 'Gửi thành công!' : 'Gửi thất bại' }}</h3>
    <p class="modal-desc">{{ resultModal.message }}</p>

    <div class="modal-actions">
      <button class="btn-modal" 
              [ngClass]="resultModal.isSuccess ? 'btn-ok' : 'btn-retry'"
              (click)="closeResultModal()">
        {{ resultModal.isSuccess ? 'Hoàn tất' : 'Thử lại' }}
      </button>
    </div>

  </div>
</div>